<!DOCTYPE html>
<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="description" content="Fitting on High performance cluster">
  <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">
  <link rel="stylesheet" href="../fonts/Serif/cmun-serif.css" />

  <!--Mathematics with MathJax-->
  <script type="text/x-mathjax-config">      
    MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: true
  },
  "HTML-CSS": { 
  availableFonts: ["STIX"],
}
});
</script>
<script type="text/javascript" async
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>  

</head>

<body>

  <title>Fitting on High performance cluster</title>
  
  <!-- HEADER -->
  <div id="header_wrap" class="outer">
    <header class="inner">
      <a id="forkme_banner" href="https://github.com/steevelaquitaine/projInference">Github</a>
      <a id="project_author" href="http://steevelaquitaine.blogspot.com">Steeve laquitaine </a>
    </header>
  </div>

  <!--TITLE-->
  <div id="proj_title_wrap" class="outer">
    <header class="inner">
      <section id="proj_title" class="inner">
        <h1 id="proj_title"> Fitting Bayes BLS tailed LLH on Sherlock HPC </h1>
      </div>
      
      <!--Table of contents    -->
      <div id="Table_of_content_wrap" class="outer">
        <section id="table_of_content" class="inner">
          <h5 id="top"> TABLE OF CONTENTS </h5>               
          <h7><a href="#copydatacode"> <b>Copy data and codes </b><br></h7>
          <h7><a href="#submit"> <b>Submit job </b><br></h7>
          <h7><a href="#check"> <b>Check job status </b><br></h7>
          <h7><a href="#getresults"><b>Get back results </b><br></h7>
        </section>
      </div>
            
      <!-- MAIN CONTENT -->
      <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">

          <!-- SECTION -->
          <p><h7><a id="copydatacode" class="anchor" href="#copydatacode" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="#top"><b>Copy data and codes</b></a></h7> </p>

          <p> Copy codes (slcodes, mgl, mrTools), data and the batch file that will run the fit from gru@cynar computer to Sherlock cluster</p>          
          
          <code class="code">                
            rsync -a --stats gru@cynar.stanford.edu:~/proj jlg@sherlock.stanford.edu:~/jlg/<br>
            rsync -a --stats gru@cynar.stanford.edu:~/Desktop/data jlg@sherlock.stanford.edu:~/jlg/<br>
            rsync -a --stats gru@cynar.stanford.edu:~/Desktop/slwjmbls.matlab jlg@sherlock.stanford.edu:~/jlg/<br>
          </code>                          

          <p>The batch file "slwjmbls.matlab" is stored in jlg@sherlock.stanford.edu:~/ and contains the information below:</p>

          <code class="code">                
            #!/bin/bash  <br>
            #BATCH --job-name=slwjmbls<br>
            #SBATCH --output=slwjmbls.out<br>
            #SBATCH --error=slwjmbls.err<br>
            #SBATCH --time=167:00:00<br>
            #SBATCH --qos=long<br>
            #SBATCH --nodes=1<br>
            #SBATCH --ntasks-per-node=16<br>
            #SBATCH --export=All<br>
            #SBATCH --mem-per-cpu 4000<br>
            #SBATCH --mem 64000  <br>
            #SBATCH --exclusive<br>
            #SBATCH --mail-type=ALL<br>
            ##my commands<br>
            ##load matlab<br>
            ml load matlab<br>
            ##add code library path<br>
            matlab -nojvm -r "addpath(genpath('~/proj')); datapath='~/data'; slfitBayesBLStailedLLHSherlock(datapath)" outputwjmbls.log<br>
          </code>

          <p>"#SBATCH --mail-type=ALL" means you'll be mailed the fitting status (to your stanford email). note : with qos=normal and time=8:00:00 queuing time is typically less than 1 hour. Otherwise it can be days. </p>

          <!-- SECTION -->
          <p><h7><a id="submit" class="anchor" href="#submit" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="#top"><b>Submit job on Sherlock </b></a></h7> </p>
          
          <p> On sherlock, submit job </p>

          <code class="code">   
            cd ~ <br>
            sbatch slwjmbls.matlab
          </code>

          <p>And confirmation of submissions is displayed something like that : </p>
          
          <code class="code">         
            Submitted batch job 15416695<br>
          </code>

          <!-- SECTION -->
          <p><h7><a id="check" class="anchor" href="#check" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="#top"><b>Check job status </b></a></h7> </p>          
          <p>Then if you check the status of your jobs by calling squeue -u $user</p>
          
          <code class="code">     
            squeue -u jlg
          </code>     

          <p>You get </p>

          <code class="code">     
           JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)<br>           
           15416695    normal slwjmbls   jlg  R      40:03      1 sh-2-34<br>           
         </code>    

         <p> where "PD" means your job is pending and "R" that it is running. You can actually see that it is running by opening your job output (assuming you matlab function print stuffs) by opening the .out file you have created in your submission batch file at its beginning (3rd line, e.g., in that case outputwjmbls.log). Go to your home directory ~/jlg/ and open it : </p>

         <code class="code">     
          vim slwjmbls.out
        </code>

        <!-- SECTION -->
        <p><h7><a id="getresults" class="anchor" href="#getresults" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="#top"><b>Get back results </b></a></h7> </p>

        <p>When computations are done you can get back the results by :</p>

        <code class="code">     
          scp -r jlg@sherlock.stanford.edu:~/data/fitwjmbls gru@cynar.stanford.edu:~/Desktop/
        </code>

      </section>
    </div>
    

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Projinference maintained by <a href="https://github.com/steevelaquitaine">steevelaquitaine</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
  </html>
